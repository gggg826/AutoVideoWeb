# AdAllianceTools 测试网站 - 开发任务清单

## Week 1: 基础设施搭建（P0）

### Day 1-2: 项目初始化
- [ ] P0-1: 创建项目目录结构
  - [ ] backend/app目录
  - [ ] frontend/public目录
  - [ ] frontend/admin目录
  - [ ] data目录
  - [ ] tests目录
- [ ] P0-2: 配置开发环境
  - [ ] 创建虚拟环境
  - [ ] 编写requirements.txt
  - [ ] 安装依赖
- [ ] P0-3: 数据库设计
  - [ ] 设计visits表结构
  - [ ] 设计analytics_summary表结构
  - [ ] 编写init_db.py脚本
- [ ] P0-4: FastAPI基础框架
  - [ ] 创建main.py入口
  - [ ] 配置CORS
  - [ ] 配置静态文件服务
  - [ ] 测试基础路由

**里程碑M1**: FastAPI启动成功，数据库表创建成功

### Day 3-5: 核心追踪API
- [ ] P0-5: 实现追踪API端点
  - [ ] POST /api/track路由
  - [ ] 请求体验证（Pydantic）
  - [ ] 响应格式定义
- [ ] P0-6: IP信息采集
  - [ ] 获取真实IP（考虑X-Forwarded-For）
  - [ ] IP地理位置解析
  - [ ] 代理检测逻辑
- [ ] P0-7: User-Agent解析
  - [ ] 使用user-agents库解析
  - [ ] 提取设备类型
  - [ ] 提取浏览器信息
  - [ ] 提取操作系统信息
- [ ] P0-8: 基础指纹采集
  - [ ] Canvas指纹处理
  - [ ] WebGL指纹处理
  - [ ] 字体列表处理
  - [ ] 生成指纹哈希
- [ ] P0-9: 数据库CRUD操作
  - [ ] 创建database.py
  - [ ] 创建models.py
  - [ ] 创建crud.py
  - [ ] 编写插入访问记录函数

**里程碑M2**: 追踪API工作正常，数据成功写入数据库

---

## Week 2: 前端开发（P1）

### Day 1-3: 测试页面开发
- [ ] P1-1: 主页设计（index.html）
  - [ ] HTML结构
  - [ ] CSS样式
  - [ ] 基础内容
- [ ] P1-2: 着陆页设计（landing.html）
  - [ ] 简单的产品介绍页
  - [ ] 包含一些文本和图片
- [ ] P1-3: 广告页设计（ad-page.html）
  - [ ] 模拟广告展示
  - [ ] 追踪像素集成
- [ ] P1-4: 追踪脚本开发（tracker.js）
  - [ ] 自动采集Canvas指纹
  - [ ] 自动采集WebGL指纹
  - [ ] 自动采集字体列表
  - [ ] 采集屏幕分辨率、时区、语言
  - [ ] 发送追踪请求到API
- [ ] P1-5: 鼠标轨迹记录
  - [ ] 监听mousemove事件
  - [ ] 采样存储（每100ms一次）
  - [ ] 页面卸载时上传
- [ ] P1-6: 滚动深度记录
  - [ ] 监听scroll事件
  - [ ] 计算最大滚动深度
  - [ ] 页面卸载时上传

**里程碑M3**: 测试页面可访问，tracker.js正常工作

### Day 4-5: 管理后台UI
- [ ] P1-7: 仪表盘页面（admin/index.html）
  - [ ] 实时访客数卡片
  - [ ] 今日访问统计卡片
  - [ ] 昨日访问统计卡片
  - [ ] 访问趋势图表（Chart.js）
  - [ ] 设备类型饼图
- [ ] P1-8: 访问日志页面（admin/logs.html）
  - [ ] DataTables集成
  - [ ] 显示所有访问记录
  - [ ] 分页功能
  - [ ] 日期筛选
  - [ ] IP筛选
  - [ ] 设备类型筛选
  - [ ] 真实性评分筛选

**里程碑M4**: 管理后台基础功能完成

---

## Week 3: 高级功能（P1）

### Day 1-3: 统计分析API
- [ ] P1-9: 访问量统计API
  - [ ] GET /api/admin/stats/trend
  - [ ] 按小时聚合
  - [ ] 按天聚合
  - [ ] 按周聚合
  - [ ] 按月聚合
- [ ] P1-10: IP分布统计
  - [ ] 按国家统计
  - [ ] 按城市统计
  - [ ] 世界地图可视化数据
- [ ] P1-11: 设备类型分布统计
  - [ ] PC vs Mobile
  - [ ] 浏览器分布
  - [ ] 操作系统分布
- [ ] P1-12: 时区分布统计
  - [ ] 按时区聚合
  - [ ] 检测时区与IP不一致
- [ ] P1-13: Referrer来源统计
  - [ ] 按域名分组
  - [ ] 直接访问 vs 引荐访问
- [ ] P1-14: 停留时间分析
  - [ ] 平均停留时间
  - [ ] 停留时间分布图
  - [ ] 跳出率计算

**里程碑M5**: 统计分析API完成

### Day 4-5: 异常检测
- [ ] P1-15: 重复访问检测
  - [ ] 基于指纹哈希检测
  - [ ] 短时间内多次访问标记
  - [ ] 配置检测时间窗口
- [ ] P1-16: 代理检测
  - [ ] 数据中心IP检测
  - [ ] 常见代理端口检测
  - [ ] 代理特征分析
- [ ] P1-17: 机器人检测
  - [ ] UA黑名单检测
  - [ ] 行为异常检测（停留时间过短）
  - [ ] 缺失指纹检测
- [ ] P1-18: 真实性评分算法
  - [ ] 指纹完整度评分（60%）
    - Canvas存在: +20分
    - WebGL存在: +20分
    - 字体列表完整: +20分
  - [ ] 行为自然度评分（30%）
    - 停留时间合理: +15分
    - 鼠标移动存在: +10分
    - 滚动行为存在: +5分
  - [ ] IP质量评分（10%）
    - 非代理IP: +10分
    - 代理IP: +5分
    - 数据中心IP: +0分

**里程碑M6**: 异常检测功能完成

---

## Week 4: 优化和部署（P2）

### Day 1-2: 数据导出和可视化
- [ ] P2-1: CSV导出功能
  - [ ] GET /api/admin/export/csv
  - [ ] 生成CSV文件
  - [ ] 文件下载响应
- [ ] P2-2: JSON导出功能
  - [ ] GET /api/admin/export/json
  - [ ] 格式化JSON输出
- [ ] P2-3: 统计图表优化
  - [ ] Chart.js配置优化
  - [ ] 响应式设计
  - [ ] 主题配色
- [ ] P2-4: 实时数据推送
  - [ ] WebSocket /ws/live
  - [ ] 新访问实时推送
  - [ ] 前端WebSocket客户端

**里程碑M7**: 数据导出和实时推送完成

### Day 3-4: 性能优化
- [ ] P2-5: 数据库索引优化
  - [ ] 为timestamp添加索引
  - [ ] 为ip_address添加索引
  - [ ] 为fingerprint_hash添加索引
  - [ ] 分析查询性能
- [ ] P2-6: API响应缓存
  - [ ] 使用内存缓存统计数据
  - [ ] 配置缓存过期时间
  - [ ] 缓存失效策略
- [ ] P2-7: 前端资源压缩
  - [ ] CSS/JS压缩
  - [ ] Gzip压缩
  - [ ] 静态资源CDN（可选）
- [ ] P2-8: 负载测试
  - [ ] 使用Locust编写测试脚本
  - [ ] 1000并发测试
  - [ ] 性能瓶颈分析

**里程碑M8**: 性能优化完成，负载测试通过

### Day 5: 部署和文档
- [ ] P2-9: Docker镜像构建
  - [ ] 编写Dockerfile
  - [ ] 多阶段构建优化
  - [ ] 镜像大小优化
- [ ] P2-10: Docker Compose配置
  - [ ] docker-compose.yml
  - [ ] 环境变量配置
  - [ ] 数据持久化配置
- [ ] P2-11: 部署文档编写
  - [ ] 本地开发指南
  - [ ] Docker部署指南
  - [ ] 生产环境配置
  - [ ] 故障排查指南
- [ ] P2-12: API文档完善
  - [ ] Swagger文档补充
  - [ ] 请求示例
  - [ ] 响应示例
  - [ ] 错误码说明

**里程碑M9**: 生产环境部署成功

---

## 测试检查清单

### 功能测试
- [ ] 访问测试页面，追踪数据正常记录
- [ ] 管理后台可以查看访问日志
- [ ] 统计图表正确展示数据
- [ ] 筛选功能正常工作
- [ ] 数据导出功能正常
- [ ] 实时推送延迟 < 500ms

### 性能测试
- [ ] API响应时间 < 100ms (P95)
- [ ] 并发1000访问无错误
- [ ] 数据库写入 > 1000 TPS
- [ ] 页面加载时间 < 2秒
- [ ] CPU占用 < 50%
- [ ] 内存占用 < 512MB

### 集成测试
- [ ] 使用AdAllianceTools测试
  - [ ] 配置100个不同URL
  - [ ] 运行30线程10分钟
  - [ ] 检查指纹多样性
  - [ ] 检查时区一致性
  - [ ] 验证真实性评分 > 70

### 安全测试
- [ ] SQL注入测试
- [ ] XSS攻击测试
- [ ] CSRF防护测试
- [ ] API限流测试
- [ ] 管理后台认证测试

---

## 进度跟踪

### 完成情况
- Week 1: [ ] 0/9 完成
- Week 2: [ ] 0/8 完成
- Week 3: [ ] 0/10 完成
- Week 4: [ ] 0/12 完成
- **总体进度**: 0/39 (0%)

### 当前状态
- **阶段**: 准备阶段
- **当前任务**: 无
- **阻塞问题**: 无
- **下一步**: 开始P0-1项目初始化

### 时间记录
- 开始日期: 2025-12-02
- 预计完成: 2025-12-30
- 实际完成: -

---

## 备注

### 优先级说明
- **P0**: 必须完成，核心功能
- **P1**: 重要功能，增强可用性
- **P2**: 优化功能，提升体验

### 依赖关系
- P0必须在P1之前完成
- P1-7和P1-8依赖P1-9至P1-14的API
- P1-18依赖P1-15至P1-17的检测逻辑
- P2-4依赖完整的数据采集功能

### 风险评估
- 🟢 低风险: P0-1至P0-4（标准Web开发）
- 🟡 中风险: P1-4至P1-6（需要复杂的JS逻辑）
- 🟡 中风险: P1-15至P1-18（检测算法需调优）
- 🟠 高风险: P2-8（性能可能不达标，需优化）
